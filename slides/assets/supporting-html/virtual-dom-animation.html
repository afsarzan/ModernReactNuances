<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual DOM - React Visualization</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700;900&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        zoom: 0.9;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a3e 50%,
          #0f0f23 100%
        );
        min-height: 100vh;
        color: #fff;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      h1 {
        text-align: center;
        font-size: 3rem;
        font-weight: 900;
        background: linear-gradient(90deg, #61dafb, #00d4ff, #61dafb);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradient 3s ease infinite;
        margin-bottom: 20px;
      }

      @keyframes gradient {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .subtitle {
        text-align: center;
        color: #8892b0;
        font-size: 1.2rem;
        margin-bottom: 40px;
      }

      .demo-area {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 30px 1fr 30px 1fr;
        gap: 20px;
        align-items: start;
        margin-bottom: 40px;
      }

      .dom-column {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 24px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .dom-column h2 {
        font-size: 1rem;
        color: #61dafb;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-align: center;
      }

      .tree {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .node {
        background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
        padding: 12px 16px;
        border-radius: 8px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        position: relative;
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .node.root {
        background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
      }

      .node.changed {
        background: linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%);
        border-color: #ff6b6b;
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
      }

      .node.new {
        background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
        border-color: #00b894;
        animation: popIn 0.4s ease;
      }

      @keyframes popIn {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        70% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .children {
        display: flex;
        gap: 15px;
        justify-content: center;
        position: relative;
      }

      .connector {
        position: absolute;
        top: -15px;
        left: 50%;
        width: 2px;
        height: 15px;
        background: rgba(255, 255, 255, 0.3);
      }

      .arrow-column {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        margin-block: 8px;
      }

      .arrow {
        font-size: 2rem;
        color: #61dafb;
        animation: pulse 1.5s ease infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.5;
          transform: translateX(0);
        }
        50% {
          opacity: 1;
          transform: translateX(5px);
        }
      }

      .arrow-label {
        font-size: 0.75rem;
        color: #8892b0;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 40px;
      }

      button {
        background: linear-gradient(135deg, #61dafb 0%, #00d4ff 100%);
        color: #0f0f23;
        border: none;
        padding: 15px 40px;
        font-size: 1rem;
        font-weight: 700;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(97, 218, 251, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      button.reset {
        background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
        color: #fff;
      }

      .explanation {
        background: rgba(97, 218, 251, 0.1);
        border: 1px solid rgba(97, 218, 251, 0.3);
        border-radius: 12px;
        padding: 24px;
        margin-top: 20px;
      }

      .explanation h3 {
        color: #61dafb;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .step {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 15px;
        opacity: 0.5;
        transition: all 0.3s ease;
      }

      .step.active {
        opacity: 1;
      }

      .step-number {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      .step.active .step-number {
        background: linear-gradient(135deg, #61dafb 0%, #00d4ff 100%);
        color: #0f0f23;
      }

      .step-content {
        flex: 1;
      }

      .step-content h4 {
        margin-bottom: 5px;
        font-weight: 600;
      }

      .step-content p {
        color: #8892b0;
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .diff-highlight {
        background: rgba(255, 107, 107, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #ff6b6b;
        display: none;
      }

      .diff-highlight.show {
        display: block;
        animation: slideIn 0.4s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(-20px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .diff-highlight code {
        font-family: 'JetBrains Mono', monospace;
        color: #ff6b6b;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 900;
        color: #61dafb;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #8892b0;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 30px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
      }

      .legend-color.unchanged {
        background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
      }

      .legend-color.changed {
        background: linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%);
      }

      .legend-color.new {
        background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Virtual DOM & Reconciliation</h1>
      <p class="subtitle">
        See how React efficiently updates the UI with minimal DOM operations
      </p>

      <div class="demo-area">
        <!-- Old Virtual DOM -->
        <div class="dom-column">
          <h2>Previous Virtual DOM</h2>
          <div class="tree" id="old-vdom">
            <div class="node root">&lt;div&gt;</div>
            <div class="children">
              <div class="node">&lt;h1&gt;Title&lt;/h1&gt;</div>
            </div>
            <div class="children" id="old-list">
              <div class="node">&lt;li&gt;Apple&lt;/li&gt;</div>
              <div class="node">&lt;li&gt;Banana&lt;/li&gt;</div>
              <!-- <div class="node">&lt;li&gt;Cherry&lt;/li&gt;</div> -->
            </div>
          </div>
        </div>

        <!-- Arrow 1 -->
        <div class="arrow-column">
          <span class="arrow">→</span>
          <span class="arrow-label">Diff</span>
        </div>

        <!-- New Virtual DOM -->
        <div class="dom-column">
          <h2>New Virtual DOM</h2>
          <div class="tree" id="new-vdom">
            <div class="node root">&lt;div&gt;</div>
            <div class="children">
              <div class="node">&lt;h1&gt;Title&lt;/h1&gt;</div>
            </div>
            <div class="children" id="new-list">
              <div class="node">&lt;li&gt;Apple&lt;/li&gt;</div>
              <div class="node">&lt;li&gt;Banana&lt;/li&gt;</div>
              <!-- <div class="node">&lt;li&gt;Cherry&lt;/li&gt;</div> -->
            </div>
          </div>
        </div>

        <!-- Arrow 2 -->
        <div class="arrow-column">
          <span class="arrow">→</span>
          <span class="arrow-label">Patch</span>
        </div>

        <!-- Real DOM -->
        <div class="dom-column">
          <h2>Real DOM</h2>
          <div class="tree" id="real-dom">
            <div class="node root">&lt;div&gt;</div>
            <div class="children">
              <div class="node">&lt;h1&gt;Title&lt;/h1&gt;</div>
            </div>
            <div class="children" id="real-list">
              <div class="node">&lt;li&gt;Apple&lt;/li&gt;</div>
              <div class="node">&lt;li&gt;Banana&lt;/li&gt;</div>
              <!-- <div class="node">&lt;li&gt;Cherry&lt;/li&gt;</div> -->
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button onclick="simulateUpdate()">Simulate State Change</button>
        <button onclick="addItem()">Add Item</button>
        <button onclick="resetDemo()" class="reset">Reset</button>
      </div>

      <div class="diff-highlight" id="diff-result">
        <strong>Diff Result:</strong> Only <code>1</code> DOM operation needed
        instead of recreating the entire list!
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="total-nodes">6</div>
          <div class="stat-label">Total Nodes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="changed-nodes">0</div>
          <div class="stat-label">Changed Nodes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="dom-ops">0</div>
          <div class="stat-label">DOM Operations</div>
        </div>
      </div>

      <div class="explanation">
        <h3>How Reconciliation Works</h3>
        <div class="step" id="step1">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>State Change Triggers Re-render</h4>
            <p>
              When state or props change, React creates a new Virtual DOM tree
              representing the updated UI.
            </p>
          </div>
        </div>
        <div class="step" id="step2">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>Diffing Algorithm Compares Trees</h4>
            <p>
              React compares the new Virtual DOM with the previous one,
              identifying exactly what changed.
            </p>
          </div>
        </div>
        <div class="step" id="step3">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>Calculate Minimum Updates</h4>
            <p>
              React determines the minimum number of operations needed to update
              the real DOM.
            </p>
          </div>
        </div>
        <div class="step" id="step4">
          <div class="step-number">4</div>
          <div class="step-content">
            <h4>Batch Update Real DOM</h4>
            <p>
              Only the changed elements are updated in the actual DOM - no
              unnecessary re-painting!
            </p>
          </div>
        </div>
      </div>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color unchanged"></div>
          <span>Unchanged</span>
        </div>
        <div class="legend-item">
          <div class="legend-color changed"></div>
          <span>Changed/Updated</span>
        </div>
        <div class="legend-item">
          <div class="legend-color new"></div>
          <span>New Element</span>
        </div>
      </div>
    </div>

    <script>
      let currentStep = 0;
      let itemCount = 3;

      function highlightStep(step) {
        document
          .querySelectorAll('.step')
          .forEach((s) => s.classList.remove('active'));
        if (step > 0) {
          document.getElementById(`step${step}`).classList.add('active');
        }
      }

      function simulateUpdate() {
        resetDemo();

        // Step 1: Create new VDOM (visual)
        setTimeout(() => {
          highlightStep(1);
          const newList = document.getElementById('new-list');
          newList.children[1].innerHTML = '&lt;li&gt;Blueberry&lt;/li&gt;';
          newList.children[1].style.color = 'orange';
        }, 500);

        // Step 2: Diffing
        setTimeout(() => {
          highlightStep(2);
          const oldBanana = document.getElementById('old-list').children[1];
          const newBlueberry = document.getElementById('new-list').children[1];
          oldBanana.classList.add('changed');
          newBlueberry.classList.add('changed');
          const newList = document.getElementById('new-list');
          newList.children[1].style.color = 'white';
          const columns = document.querySelectorAll('.dom-column');
          [columns[0], columns[1]].forEach((el) => {
            el.style.border = '3px dashed green';
          });
        }, 1500);

        // Step 3: Calculate minimum updates
        setTimeout(() => {
          highlightStep(3);
          document.getElementById('diff-result').classList.add('show');
          document.getElementById('changed-nodes').textContent = '1';
        }, 2500);

        // Step 4: Update real DOM
        setTimeout(() => {
          highlightStep(4);
          const realBanana = document.getElementById('real-list').children[1];
          realBanana.classList.add('changed');
          realBanana.innerHTML = '&lt;li&gt;Blueberry&lt;/li&gt;';
          document.getElementById('dom-ops').textContent = '1';
          const columns = document.querySelectorAll('.dom-column');
          columns.forEach((el, index) => {
            if (index !== 2) {
              el.style.border = '3px dashed transparent';
            } else {
              el.style.border = '3px dashed orange';
            }
          });
        }, 3500);
      }

      function addItem() {
        itemCount++;

        // Step 1
        setTimeout(() => {
          highlightStep(1);
          const newList = document.getElementById('new-list');
          const newNode = document.createElement('div');
          newNode.className = 'node';
          newNode.innerHTML = `&lt;li&gt;Date&lt;/li&gt;`;
          newNode.style.color = '#00cec9';
          newList.appendChild(newNode);
        }, 500);

        // Step 2: Diffing
        setTimeout(() => {
          highlightStep(2);
          const newDate = document.getElementById('new-list').lastChild;
          newDate.classList.add('new');
          newDate.style.color = 'white';
          const columns = document.querySelectorAll('.dom-column');
          [columns[0], columns[1]].forEach((el) => {
            el.style.border = '3px dashed green';
          });
        }, 1500);

        // Step 3
        setTimeout(() => {
          highlightStep(3);
          document.getElementById('diff-result').innerHTML =
            '<strong>Diff Result:</strong> Only <code>1</code> insertion needed - existing items unchanged!';
          document.getElementById('diff-result').classList.add('show');
          document.getElementById('changed-nodes').textContent = '1';
        }, 2500);

        // Step 4: Update real DOM
        setTimeout(() => {
          highlightStep(4);
          const realList = document.getElementById('real-list');
          const realNode = document.createElement('div');
          realNode.className = 'node new';
          realNode.innerHTML = `&lt;li&gt;Date&lt;/li&gt;`;
          realList.appendChild(realNode);

          const oldList = document.getElementById('old-list');
          const oldNode = document.createElement('div');
          oldNode.className = 'node';
          oldNode.innerHTML = `&lt;li&gt;Date&lt;/li&gt;`;
          oldList.appendChild(oldNode);

          document.getElementById('dom-ops').textContent = '1';
          document.getElementById('total-nodes').textContent =
            parseInt(document.getElementById('total-nodes').textContent) + 1;
          const columns = document.querySelectorAll('.dom-column');
          columns.forEach((el, index) => {
            if (index !== 2) {
              el.style.border = '3px dashed transparent';
            } else {
              el.style.border = '3px dashed orange';
            }
          });
        }, 3500);
      }

      function resetDemo() {
        itemCount = 3;
        document
          .querySelectorAll('.step')
          .forEach((s) => s.classList.remove('active'));
        document.getElementById('diff-result').classList.remove('show');
        document.getElementById('diff-result').innerHTML =
          '<strong>Diff Result:</strong> Only <code>1</code> DOM operation needed instead of recreating the entire list!';

        document.getElementById('total-nodes').textContent = '6';
        document.getElementById('changed-nodes').textContent = '0';
        document.getElementById('dom-ops').textContent = '0';

        const lists = ['old-list', 'new-list', 'real-list'];
        lists.forEach((listId) => {
          const list = document.getElementById(listId);
          list.innerHTML = `
                    <div class="node">&lt;li&gt;Apple&lt;/li&gt;</div>
                    <div class="node">&lt;li&gt;Banana&lt;/li&gt;</div>
                `;
        });

        const columns = document.querySelectorAll('.dom-column');
        columns.forEach((el, index) => {
          el.style.border = '3px dashed transparent';
        });
      }
    </script>
  </body>
</html>
